<!DOCTYPE html>
<html><head><meta charset="utf-8"><style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: transparent; overflow: hidden; }
#bubble-container { position: absolute; }
#bubble-box {
  position: relative;
  border-radius: 16px;
  padding: 16px 20px;
  font-family: "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
  line-height: 1.5; word-break: break-all; white-space: pre-wrap;
}
#bubble-tail {
  position: absolute; width: 0; height: 0;
}
</style></head>
<body>
<div id="bubble-container">
  <div id="bubble-box"></div>
</div>
<svg id="tail-svg" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;">
  <polygon id="tail-poly" />
</svg>
<script>
function renderFrame(state) {
  var d = state.data || {};
  var s = d.style || {};
  var W = state.width;
  var H = state.height;

  var fontSize  = s.fontSize  || 36;
  var bgColor   = s.bgColor   || "rgba(255,255,255,0.95)";
  var textColor = s.textColor || "#222222";
  var border    = s.border    || "2px solid #888";
  var radius    = s.radius    || 16;
  var tailColor = s.tailColor || "rgba(255,255,255,0.95)";

  // 位置（正規化座標）
  var pos  = d.pos  || {x: 0.25, y: 0.3};
  var sz   = d.size || {w: 0.45, h: 0.2};
  var anch = d.anchor || {x: 0.2, y: 0.7};

  var bx = pos.x * W;
  var by = pos.y * H;
  var bw = sz.w * W;
  var bh = sz.h * H;
  var ax = anch.x * W;
  var ay = anch.y * H;

  var container = document.getElementById("bubble-container");
  container.style.left = bx + "px";
  container.style.top  = by + "px";
  container.style.width  = bw + "px";
  container.style.height = bh + "px";

  var box = document.getElementById("bubble-box");
  box.style.width  = bw + "px";
  box.style.minHeight = bh + "px";
  box.style.backgroundColor = bgColor;
  box.style.color = textColor;
  box.style.fontSize = fontSize + "px";
  box.style.border = border;
  box.style.borderRadius = radius + "px";
  box.textContent = d.text || "";

  // しっぽ（三角）SVG
  var svg = document.getElementById("tail-svg");
  var poly = document.getElementById("tail-poly");
  // 吹き出し下辺中央 → anchor 方向にしっぽを描画
  var cx = bx + bw / 2;
  var cy = by + bh;
  // しっぽの幅
  var tw = Math.min(bw * 0.15, 30);
  var p1x = cx - tw;
  var p1y = cy;
  var p2x = cx + tw;
  var p2y = cy;
  var p3x = ax;
  var p3y = ay;
  poly.setAttribute("points", p1x+","+p1y+" "+p2x+","+p2y+" "+p3x+","+p3y);
  poly.setAttribute("fill", tailColor);
  poly.setAttribute("stroke", "#888");
  poly.setAttribute("stroke-width", "2");

  // アニメーション
  var fadeIn  = s.fadeIn  !== undefined ? s.fadeIn  : 0.1;
  var fadeOut = s.fadeOut !== undefined ? s.fadeOut : 0.1;
  var opacity = 1.0;
  if (state.u < fadeIn && fadeIn > 0) {
    opacity = state.u / fadeIn;
  } else if (state.u > (1.0 - fadeOut) && fadeOut > 0) {
    opacity = (1.0 - state.u) / fadeOut;
  }
  container.style.opacity = opacity;
  svg.style.opacity = opacity;
}
</script>
</body></html>
